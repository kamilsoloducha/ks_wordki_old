version: '3'
services:
 wordki:
  container_name: wordki
  image: wordki
  build:
   context: ../../
   dockerfile: ./build/docker/App.dockerfile
   args:
    URL_PORT: 7909
  ports:
   - "5000:7909"
  volumes:
   - appbuild:/app
  links:
   - mysql
  environment:
   MYSQL_SERVER_NAME: db
  env_file:
   - secrets.env
  depends_on:
   - builder
 builder:
  container_name: builder
  image: wordki.builder
  build:
   context: ../../
   dockerfile: ./build/docker/Build.dockerfile
   args:
    BUILDER_VERSION: 0.1.0
    BUILD_CONFIG: Release
    BUILD_LOCATION: /app/out
  volumes:
   - appbuild:/app/out
 mysql:
  container_name: db
  image: mysql/mysql-server:5.7
  restart: always
  ports:
   - "3306:3306"
  volumes:
   - dbvol:/var/lib/mysql
  environment:
   MYSQL_ROOT_PASSWORD: Akuku123
  env_file:
   - secrets.env
  command: mysqld --character-set-server=utf8 --collation-server=utf8_general_ci
volumes:
 appbuild:
  external:
   name: appbuild
 dbvol:
  external:
   name: dbvol
